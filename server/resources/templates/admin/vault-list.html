{% if vaults|not-empty %}
  {% for vault in vaults %}
    {% include "templates/components/vault-card.html" %}
  {% endfor %}
{% else %}
  {% with icon="inbox" title="No sites yet" message="Create your first site to start publishing your Obsidian notes to the web" cta-text="Create first site" cta-action="openCreateModal()" cta-icon="plus" grid-full=true %}
    {% include "templates/components/empty-state.html" %}
  {% endwith %}
{% endif %}

<script>
// Toggle action menu
function toggleActionMenu(button) {
    const menu = button.nextElementSibling;
    const isOpen = menu.classList.contains('open');

    // Close all menus first
    document.querySelectorAll('.action-menu.open').forEach(m => m.classList.remove('open'));

    // Toggle this menu
    if (!isOpen) {
        menu.classList.add('open');
    }
}

// Close menus when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.vault-actions')) {
        document.querySelectorAll('.action-menu.open').forEach(m => m.classList.remove('open'));
    }
});

// Toggle sync key visibility
function toggleSyncKey(button, vaultId) {
    const keyElement = document.getElementById(`key-${vaultId}`);
    const fullKey = keyElement.dataset.key;
    const currentText = keyElement.textContent.trim();
    const isHidden = currentText.includes('*');

    const icon = button.querySelector('i');

    if (isHidden) {
        keyElement.textContent = fullKey;
        icon.setAttribute('data-lucide', 'eye-off');
        button.title = '隐藏';
    } else {
        const masked = fullKey.substring(0, 8) + '******' + fullKey.substring(fullKey.length - 8);
        keyElement.textContent = masked;
        icon.setAttribute('data-lucide', 'eye');
        button.title = '显示';
    }

    lucide.createIcons();
}
</script>
