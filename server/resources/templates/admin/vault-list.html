{% if vaults|not-empty %}
  {% for vault in vaults %}
  <div class="vault-card bg-base-100 rounded border border-base-300
              hover:border-primary transition-colors duration-150 p-6">

    <!-- Header: Name + Domain + Actions -->
    <div class="flex items-start justify-between mb-4">
      <div class="flex-1 min-w-0">
        <h3 class="text-lg font-semibold text-base-content mb-1 truncate">
          {{vault.name}}
        </h3>
        <a href="http://{{vault.domain}}" target="_blank"
           class="text-sm text-base-content/60 hover:text-primary inline-flex items-center gap-1 group transition-colors">
          <span class="material-symbols-outlined text-base">language</span>
          <span class="group-hover:underline">{{vault.domain}}</span>
          <span class="material-symbols-outlined text-base opacity-0 group-hover:opacity-100 transition-opacity">
            open_in_new
          </span>
        </a>
      </div>

      <!-- Quick Actions -->
      <div class="flex items-center gap-1">
        <a href="http://{{vault.domain}}" target="_blank"
           class="btn btn-ghost btn-sm btn-circle" title="Open site">
          <span class="material-symbols-outlined">open_in_new</span>
        </a>
        <button class="btn btn-ghost btn-sm btn-circle"
                hx-delete="/admin/vaults/{{vault.id}}"
                hx-confirm="Delete '{{vault.name}}'? This action cannot be undone."
                hx-target="#vault-list"
                hx-swap="none"
                hx-on::after-request="if(event.detail.successful) {
                  showToast('Site deleted successfully', 'success');
                  htmx.trigger('#vault-list', 'refreshList');
                }">
          <span class="htmx-indicator loading loading-spinner loading-xs"></span>
          <span class="delete-text material-symbols-outlined text-error">delete</span>
        </button>
      </div>
    </div>

    <!-- Sync Key Section -->
    <div class="sync-key-section bg-base-200 rounded p-4 mb-4">
      <div class="flex items-center justify-between mb-2">
        <span class="text-xs font-semibold text-base-content/60 uppercase tracking-wide">
          Sync Key
        </span>
        <div class="flex gap-1">
          <button onclick="toggleKey(this, '{{vault.id}}')"
                  class="btn btn-xs btn-ghost" title="Show/Hide key">
            <span class="material-symbols-outlined text-base">visibility</span>
          </button>
          <button onclick="copyToClipboard('{{vault.sync-key}}', this)"
                  class="btn btn-xs btn-ghost copy-btn" title="Copy to clipboard">
            <span class="material-symbols-outlined text-base">content_copy</span>
          </button>
        </div>
      </div>
      <code id="key-{{vault.id}}"
            class="block text-xs font-mono text-base-content bg-base-100 rounded p-2 break-all select-all"
            data-key="{{vault.sync-key}}">
        {{vault.masked-key}}
      </code>
    </div>

    <!-- Root Doc Selector -->
    <div class="root-doc-section">
      <label class="block text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-2">
        Home Page
      </label>
      {% with vault-id=vault.id root-doc-id=vault.root-doc-id documents=vault.documents %}
        {% include "templates/admin/root-doc-selector.html" %}
      {% endwith %}
    </div>
  </div>
  {% endfor %}
{% else %}
  <!-- Empty State -->
  <div class="col-span-full">
    <div class="text-center py-16 px-4">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-base-200 mb-4">
        <span class="material-symbols-outlined text-4xl text-base-content/40">inbox</span>
      </div>
      <h3 class="text-lg font-semibold text-base-content mb-2">No sites yet</h3>
      <p class="text-sm text-base-content/60 mb-6 max-w-sm mx-auto">
        Create your first site to start publishing your Obsidian notes to the web
      </p>
      <button onclick="my_modal_create.showModal()" class="btn btn-primary gap-2">
        <span class="material-symbols-outlined">add</span>
        <span>Create Your First Site</span>
      </button>
    </div>
  </div>
{% endif %}
