<style>
.vault-card {
    background: white;
    border: 1px solid var(--border-color);
    padding: 1.5rem;
}

.vault-card:hover {
    border-color: var(--border-hover);
}

.vault-header {
    padding-bottom: 1.25rem;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.vault-info h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.375rem;
}

.vault-domain {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    text-decoration: none;
}

.vault-domain:hover {
    color: var(--accent);
}

.vault-actions {
    position: relative;
}

.action-menu-btn {
    padding: 0.375rem;
    border: 1px solid var(--border-color);
    background: white;
    cursor: pointer;
    color: var(--text-secondary);
}

.action-menu-btn:hover {
    border-color: var(--border-hover);
    color: var(--text-primary);
}

.action-menu {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.25rem;
    min-width: 160px;
    background: white;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    z-index: 10;
}

.action-menu.open {
    display: block;
}

.action-menu button {
    width: 100%;
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
    text-align: left;
    border: none;
    background: none;
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.625rem;
}

.action-menu button:hover {
    background: #fafafa;
}

.action-menu button.danger {
    color: var(--error);
}

.action-menu button + button {
    border-top: 1px solid var(--border-color);
}

.vault-section {
    margin-bottom: 1.25rem;
}

.vault-section:last-child {
    margin-bottom: 0;
}

.section-label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.625rem;
}

.sync-key-box {
    background: #fafafa;
    border: 1px solid var(--border-color);
    padding: 0.875rem;
}

.sync-key-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.625rem;
}

.sync-key-actions {
    display: flex;
    gap: 0.25rem;
}

.icon-btn {
    padding: 0.25rem;
    border: none;
    background: none;
    cursor: pointer;
    color: var(--text-tertiary);
}

.icon-btn:hover {
    color: var(--text-primary);
}

.sync-key-value {
    font-family: 'Courier New', monospace;
    font-size: 0.8125rem;
    color: var(--text-primary);
    word-break: break-all;
    user-select: all;
}

.home-page-select {
    width: 100%;
    padding: 0.5rem 0.625rem;
    font-size: 0.875rem;
    border: 1px solid var(--border-color);
    background: white;
    color: var(--text-primary);
    cursor: pointer;
}

.home-page-select:focus {
    outline: 2px solid var(--accent);
    outline-offset: -1px;
    border-color: transparent;
}

.warning-box {
    padding: 0.75rem;
    border: 1px solid #fbbf24;
    background: #fef3c7;
    font-size: 0.8125rem;
    color: #92400e;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
</style>

<!-- Vault Card Component
  Parameters:
  - vault: vault object with id, name, domain, sync-key, masked-key, root-doc-id, documents
-->
<div class="vault-card">
    <!-- Header -->
    <div class="vault-header">
      <div class="vault-info">
        <h3>{{vault.name}}</h3>
        <a href="http://{{vault.domain}}" target="_blank" class="vault-domain">
          <i data-lucide="globe" style="width: 0.875rem; height: 0.875rem;"></i>
          <span>{{vault.domain}}</span>
          <i data-lucide="external-link" style="width: 0.875rem; height: 0.875rem;"></i>
        </a>
      </div>

      <!-- Actions -->
      <div class="vault-actions">
        <button type="button"
                class="action-menu-btn"
                onclick="toggleActionMenu(this)">
          <i data-lucide="more-vertical" style="width: 1.125rem; height: 1.125rem;"></i>
        </button>
        <div class="action-menu">
          <button type="button" onclick="window.open('http://{{vault.domain}}', '_blank'); toggleActionMenu(this.closest('.vault-actions').querySelector('.action-menu-btn'))">
            <i data-lucide="external-link" style="width: 0.875rem; height: 0.875rem;"></i>
            <span>打开站点</span>
          </button>
          <button type="button" onclick="openEditModal('{{vault.id}}', '{{vault.name}}', '{{vault.domain}}'); toggleActionMenu(this.closest('.vault-actions').querySelector('.action-menu-btn'))">
            <i data-lucide="pencil" style="width: 0.875rem; height: 0.875rem;"></i>
            <span>编辑</span>
          </button>
          <button type="button"
                  class="danger"
                  hx-delete="/admin/vaults/{{vault.id}}"
                  hx-confirm="确定删除「{{vault.name}}」吗？此操作无法撤销。"
                  hx-swap="none"
                  hx-on::after-request="if(event.detail.successful) { showNotification('站点已删除', 'success'); htmx.trigger('body', 'refreshList'); } else { showNotification('删除失败', 'error'); }">
            <i data-lucide="trash-2" style="width: 0.875rem; height: 0.875rem;"></i>
            <span>删除</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Sync Key Section -->
    <div class="vault-section">
      <span class="section-label">同步密钥</span>
      <div class="sync-key-box">
        <div class="sync-key-header">
          <span style="font-size: 0.75rem; color: var(--text-tertiary);">用于 Obsidian 插件同步</span>
          <div class="sync-key-actions">
            <button type="button"
                    class="icon-btn"
                    onclick="toggleSyncKey(this, '{{vault.id}}')"
                    title="显示/隐藏">
              <i data-lucide="eye" style="width: 0.875rem; height: 0.875rem;"></i>
            </button>
            <button type="button"
                    class="icon-btn"
                    onclick="copyToClipboard('{{vault.sync-key}}')"
                    title="复制">
              <i data-lucide="copy" style="width: 0.875rem; height: 0.875rem;"></i>
            </button>
          </div>
        </div>
        <div class="sync-key-value" id="key-{{vault.id}}" data-key="{{vault.sync-key}}">
          {{vault.masked-key}}
        </div>
      </div>
    </div>

    <!-- Home Page Section -->
    <div class="vault-section">
      <span class="section-label">首页设置</span>
      {% with vault-id=vault.id root-doc-id=vault.root-doc-id documents=vault.documents %}
        {% include "templates/admin/root-doc-selector.html" %}
      {% endwith %}
    </div>
</div>
